<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1109px" preserveAspectRatio="none" style="width:1344px;height:1109px;background:#FEFEFE;" version="1.1" viewBox="0 0 1344 1109" width="1344px" zoomAndPan="magnify"><title>Approach C &#8212; Hybrid (DB Pre-Aggregation + Domain Finalization)</title><defs/><g><rect fill="#FEFEFE" height="1109" style="stroke:none;stroke-width:1;" width="1344" x="0" y="0"/><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="817.4053" x="262.1304" y="35.4209">Approach C &#8212; Hybrid (DB Pre-Aggregation + Domain Finalization)</text><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="930.3125" style="stroke:#000000;stroke-width:1;" width="10" x="101.1943" y="109.2031"/></g><g><title>ReportingService</title><rect fill="#FFFFFF" height="880.0469" style="stroke:#000000;stroke-width:1;" width="10" x="362.3218" y="130.3359"/></g><g><title>PortfolioPort</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="571.481" y="202.6016"/></g><g><title>TransactionQueryPort</title><rect fill="#FFFFFF" height="260.9922" style="stroke:#000000;stroke-width:1;" width="10" x="759.1689" y="346.1328"/></g><g><title>HoldingPerformanceCalculator</title><rect fill="#FFFFFF" height="185.3281" style="stroke:#000000;stroke-width:1;" width="10" x="995.0093" y="795.9219"/></g><g><title>StockPriceProviderPort</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="1225.8423" y="679.3906"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Controller" id="part1-lifeline"><g><title>PortfolioRestController</title><rect fill="#000000" fill-opacity="0.00000" height="958.3125" width="8" x="102.1943" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="106" x2="106" y1="99.2031" y2="1057.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="Service" id="part2-lifeline"><g><title>ReportingService</title><rect fill="#000000" fill-opacity="0.00000" height="958.3125" width="8" x="363.3218" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="366.6523" x2="366.6523" y1="99.2031" y2="1057.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="PortfolioPort" id="part3-lifeline"><g><title>PortfolioPort</title><rect fill="#000000" fill-opacity="0.00000" height="958.3125" width="8" x="572.481" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="575.5962" x2="575.5962" y1="99.2031" y2="1057.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="QueryPort" id="part4-lifeline"><g><title>TransactionQueryPort</title><rect fill="#000000" fill-opacity="0.00000" height="958.3125" width="8" x="760.1689" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="763.3657" x2="763.3657" y1="99.2031" y2="1057.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="Calculator" id="part5-lifeline"><g><title>HoldingPerformanceCalculator</title><rect fill="#000000" fill-opacity="0.00000" height="958.3125" width="8" x="996.0093" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="999.9722" x2="999.9722" y1="99.2031" y2="1057.5156"/></g></g><g class="participant-lifeline" data-entity-uid="part6" data-qualified-name="PricePort" id="part6-lifeline"><g><title>StockPriceProviderPort</title><rect fill="#000000" fill-opacity="0.00000" height="958.3125" width="8" x="1226.8423" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1230.0464" x2="1230.0464" y1="99.2031" y2="1057.5156"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Controller" id="part1-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="20" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="27" y="71.6045">PortfolioRestController</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.5225" x="45.4331" y="87.9014">(Driving Adapter)</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Controller" id="part1-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="20" y="1056.5156"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="27" y="1076.5107">PortfolioRestController</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.5225" x="45.4331" y="1092.8076">(Driving Adapter)</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="Service" id="part2-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="159.3389" x="287.6523" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120.4287" x="307.1074" y="71.6045">ReportingService</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145.3389" x="294.6523" y="87.9014">(Application Service)</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="Service" id="part2-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="159.3389" x="287.6523" y="1056.5156"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="120.4287" x="307.1074" y="1076.5107">ReportingService</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145.3389" x="294.6523" y="1092.8076">(Application Service)</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="PortfolioPort" id="part3-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="131.7695" x="510.5962" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="86.3447" x="533.3086" y="71.6045">PortfolioPort</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117.7695" x="517.5962" y="87.9014">(Secondary Port)</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="PortfolioPort" id="part3-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="131.7695" x="510.5962" y="1056.5156"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="86.3447" x="533.3086" y="1076.5107">PortfolioPort</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117.7695" x="517.5962" y="1092.8076">(Secondary Port)</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="QueryPort" id="part4-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="183.6064" x="672.3657" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="152.9473" x="687.6953" y="71.6045">TransactionQueryPort</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="169.6064" x="679.3657" y="87.9014">(Secondary Port &#8212; new)</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="QueryPort" id="part4-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="183.6064" x="672.3657" y="1056.5156"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="152.9473" x="687.6953" y="1076.5107">TransactionQueryPort</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="169.6064" x="679.3657" y="1092.8076">(Secondary Port &#8212; new)</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="Calculator" id="part5-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="228.0742" x="885.9722" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="214.0742" x="892.9722" y="71.6045">HoldingPerformanceCalculator</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.4404" x="939.2891" y="87.9014">(Domain Service)</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="Calculator" id="part5-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="228.0742" x="885.9722" y="1056.5156"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="214.0742" x="892.9722" y="1076.5107">HoldingPerformanceCalculator</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.4404" x="939.2891" y="1092.8076">(Domain Service)</text></g><g class="participant participant-head" data-entity-uid="part6" data-qualified-name="PricePort" id="part6-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="173.5918" x="1144.0464" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="159.5918" x="1151.0464" y="71.6045">StockPriceProviderPort</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117.7695" x="1171.9575" y="87.9014">(Secondary Port)</text></g><g class="participant participant-tail" data-entity-uid="part6" data-qualified-name="PricePort" id="part6-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="173.5918" x="1144.0464" y="1056.5156"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="159.5918" x="1151.0464" y="1076.5107">StockPriceProviderPort</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="117.7695" x="1171.9575" y="1092.8076">(Secondary Port)</text></g><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="930.3125" style="stroke:#000000;stroke-width:1;" width="10" x="101.1943" y="109.2031"/></g><g><title>ReportingService</title><rect fill="#FFFFFF" height="880.0469" style="stroke:#000000;stroke-width:1;" width="10" x="362.3218" y="130.3359"/></g><g><title>PortfolioPort</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="571.481" y="202.6016"/></g><g><title>TransactionQueryPort</title><rect fill="#FFFFFF" height="260.9922" style="stroke:#000000;stroke-width:1;" width="10" x="759.1689" y="346.1328"/></g><g><title>HoldingPerformanceCalculator</title><rect fill="#FFFFFF" height="185.3281" style="stroke:#000000;stroke-width:1;" width="10" x="995.0093" y="795.9219"/></g><g><title>StockPriceProviderPort</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="1225.8423" y="679.3906"/></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#000000" points="350.3218,126.3359,360.3218,130.3359,350.3218,134.3359,354.3218,130.3359" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="111.1943" x2="356.3218" y1="130.3359" y2="130.3359"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="232.1274" x="118.1943" y="125.27">getHoldingsPerfomance(portfolioId)</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1332.666" x="5" y="158.9023"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="158.9023" y2="158.9023"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="161.9023" y2="161.9023"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="213.583" x="564.5415" y="148.3359"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="195.0571" x="570.5415" y="164.4028">1. Validate portfolio exists</text><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg2"><polygon fill="#000000" points="559.481,198.6016,569.481,202.6016,559.481,206.6016,563.481,202.6016" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="372.3218" x2="565.481" y1="202.6016" y2="202.6016"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="180.1592" x="379.3218" y="197.5356">getPortfolioById(PortfolioId)</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg3"><polygon fill="#000000" points="383.3218,227.7344,373.3218,231.7344,383.3218,235.7344,379.3218,231.7344" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="377.3218" x2="575.481" y1="231.7344" y2="231.7344"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="130.6919" x="389.3218" y="226.6685">Optional&lt;Portfolio&gt;</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg4"><line style="stroke:#000000;stroke-width:1;" x1="372.3218" x2="414.3218" y1="260.8672" y2="260.8672"/><line style="stroke:#000000;stroke-width:1;" x1="414.3218" x2="414.3218" y1="260.8672" y2="273.8672"/><line style="stroke:#000000;stroke-width:1;" x1="373.3218" x2="414.3218" y1="273.8672" y2="273.8672"/><polygon fill="#000000" points="383.3218,269.8672,373.3218,273.8672,383.3218,277.8672,379.3218,273.8672" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.6367" x="379.3218" y="255.8013">portfolio.orElseThrow()</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1332.666" x="5" y="302.4336"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="302.4336" y2="302.4336"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="305.4336" y2="305.4336"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="372.1348" x="485.2656" y="291.8672"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="353.6089" x="491.2656" y="307.9341">2. DB pre-aggregation &#8212; raw sums, no rounding</text><g class="message" data-entity-1="part2" data-entity-2="part4" id="msg5"><polygon fill="#000000" points="747.1689,342.1328,757.1689,346.1328,747.1689,350.1328,751.1689,346.1328" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="372.3218" x2="753.1689" y1="346.1328" y2="346.1328"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="199.9766" x="379.3218" y="341.0669">getRawAggregates(PortfolioId)</text></g><path d="M774,359.1328 L774,580.1328 L1142,580.1328 L1142,369.1328 L1132,359.1328 L774,359.1328" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1132,359.1328 L1132,369.1328 L1142,369.1328 L1132,359.1328" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="225.8179" x="780" y="376.1997">SQL returns raw numeric sums</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="185.0151" x="780" y="391.3325">per ticker &#8212; intentionally no</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="145.374" x="780" y="406.4653">rounding in the query.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="780" y="421.5981">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="93.9326" x="780" y="436.731">SELECT ticker,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="235.0029" x="788.2646" y="451.8638">SUM(CASE WHEN type='PURCHASE'</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="292.1064" x="804.7939" y="466.9966">THEN quantity END)               AS bought_qty,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="235.0029" x="788.2646" y="482.1294">SUM(CASE WHEN type='PURCHASE'</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="323.1211" x="804.7939" y="497.2622">THEN quantity * unit_price END)  AS bought_cost,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="197.0059" x="788.2646" y="512.395">SUM(CASE WHEN type='SALE'</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="254.9092" x="804.7939" y="527.5278">THEN profit END)                 AS realized</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.3003" x="780" y="542.6606">FROM transactions</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="150.998" x="780" y="557.7935">WHERE portfolio_id = ?</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="108.5449" x="780" y="572.9263">GROUP BY ticker</text><g class="message" data-entity-1="part4" data-entity-2="part2" id="msg6"><polygon fill="#000000" points="383.3218,603.125,373.3218,607.125,383.3218,611.125,379.3218,607.125" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="377.3218" x2="763.1689" y1="607.125" y2="607.125"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.7656" x="389.3218" y="602.0591">List&lt;RawTickerAggregate&gt;</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1332.666" x="5" y="635.6914"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="635.6914" y2="635.6914"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="638.6914" y2="638.6914"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="157.5967" x="592.5347" y="625.125"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139.0708" x="598.5347" y="641.1919">3. Fetch live prices</text><g class="message" data-entity-1="part2" data-entity-2="part6" id="msg7"><polygon fill="#000000" points="1213.8423,675.3906,1223.8423,679.3906,1213.8423,683.3906,1217.8423,679.3906" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="372.3218" x2="1219.8423" y1="679.3906" y2="679.3906"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="193.8257" x="379.3218" y="674.3247">fetchStockPrice(Set&lt;Ticker&gt;)</text></g><g class="message" data-entity-1="part6" data-entity-2="part2" id="msg8"><polygon fill="#000000" points="383.3218,704.5234,373.3218,708.5234,383.3218,712.5234,379.3218,708.5234" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="377.3218" x2="1229.8423" y1="708.5234" y2="708.5234"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="164.9756" x="389.3218" y="703.4575">Map&lt;Ticker, StockPrice&gt;</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1332.666" x="5" y="737.0898"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="737.0898" y2="737.0898"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1337.666" y1="740.0898" y2="740.0898"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="393.6787" x="474.4937" y="726.5234"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="375.1528" x="480.4937" y="742.5903">4. Domain finalization &#8212; rounding &amp; business rules</text><g class="message" data-entity-1="part2" data-entity-2="part5" id="msg9"><polygon fill="#000000" points="983.0093,791.9219,993.0093,795.9219,983.0093,799.9219,987.0093,795.9219" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="372.3218" x2="989.0093" y1="795.9219" y2="795.9219"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="51.5112" x="379.3218" y="775.7231">finalize(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="250.1675" x="387.5864" y="790.856">portfolio, rawAggregates, tickerPrices)</text></g><path d="M1010,808.9219 L1010,954.9219 L1332,954.9219 L1332,818.9219 L1322,808.9219 L1010,808.9219" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1322,808.9219 L1322,818.9219 L1332,818.9219 L1322,808.9219" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="175.2715" x="1016" y="825.9888">Domain service applies:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="301.666" x="1016" y="841.1216">&#8226; BigDecimal division with SCALE=2, HALF_UP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="246.3398" x="1016" y="856.2544">&#8226; Average purchase price = cost / qty</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="246.4731" x="1016" y="871.3872">&#8226; Unrealized gain from Holding model</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="186.8242" x="1016" y="886.52">&#8226; Missing-price fallback logic</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="236.1455" x="1016" y="901.6528">&#8226; Returns immutable List.copyOf(...)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1016" y="916.7856">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.3687" x="1016" y="931.9185">Rounding stays in Java &#8212; never</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="183.7393" x="1016" y="947.0513">delegated to the DB engine.</text><g class="message" data-entity-1="part5" data-entity-2="part2" id="msg10"><polygon fill="#000000" points="383.3218,977.25,373.3218,981.25,383.3218,985.25,379.3218,981.25" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="377.3218" x2="999.0093" y1="981.25" y2="981.25"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="210.9009" x="389.3218" y="976.1841">List&lt;HoldingDTO&gt;  (immutable)</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg11"><polygon fill="#000000" points="122.1943,1006.3828,112.1943,1010.3828,122.1943,1014.3828,118.1943,1010.3828" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="116.1943" x2="366.3218" y1="1010.3828" y2="1010.3828"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="122.3892" x="128.1943" y="1005.3169">List&lt;HoldingDTO&gt;</text></g><g class="message" data-entity-1="part1" data-entity-2="part1" id="msg12"><polygon fill="#000000" points="1325.666,1035.5156,1335.666,1039.5156,1325.666,1043.5156,1329.666,1039.5156" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="106.1943" x2="1331.666" y1="1039.5156" y2="1039.5156"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="98.6172" x="113.1943" y="1034.4497">HTTP 200 JSON</text></g><?plantuml-src dLNDRkCs4BxhAQPRe6kxZhfDUpBY58xjrBjmOgrbjoYmG41Bj4n48XMIigkUzY7w17sqVP8EQUfla_HGvn29-ZZppSmtCz_e0yqev2bXt5EFZET4aWns97fCf2XuF1MfaF3jxTpyUPvcEgKmoNCfI7I0ANpv_3SiofraCVHcDn18UZ594aaJefdWy3tCH8QsuPPnahA_x6dVyz2DPX7B2TVm9X1IxqNAn9egFHLSIv6cL7xYlPbaHyOJcCGarrJstm1Hq22wPjOqHqC83wayieZYVIIQikXCnPsURRYNLtYO1xmTqaZmcCWIpC7vOWVJlRwHX2iI6MSV2ohB5wtOX75wEbkhSLrB2v7664T0vLx8ZF28JaaQ5IdHmcRbdD9EG0sWQohK8deC9E82AOuiflA_WhCuGySpSHo9fkriDuzmSLsv7q52jIEiB6DBk9TNYNeVznjhLTwzyHX-zE4tr4Hipciqq3-PqWh6OyzXZQzErgt7-kIcV1_tWXUTTMlLUOEBTWIht1IDf5SrvjgBwIjsMhHg0pLzNyXvgkZc8CMfrxTXNlg0ZP5ZOv1MOnWPI782LMHg25o0xJQZzMxajK9ir6joghgBgbUYRZJbSO7laYK73MBV-W0m68GVbo2fBYHNbWWlCehbjuG60uJaM6RKqIF-CsGPrvIVqvIMI1WHDMKK8yuHU38EV0-_XFFbVBfnruTuW4VRkzvq4ixXzyNy7dIPq_7ROBkUBl3ihKMOtyPyV2fGkaoNCB-VzQ7xcuIm4mL6zF2ao_zlUG05P_eXDu9tRXhBaL3wTTFXPFcrMPo6UwPVeclDIcf67utnqkrwTGUw6HGApz3sUjv8w057wHX-mG-_hbVR06x-S7dqA8_1bDJpwb9sTRp4rhb2ZMmilbPAHymjUQ0uV_BXbcgSv2axOXUQT3phlMeeZ61leCr4mHcYhyw-hjjjLq-H-gbByuxaxjeG6clTbcic4RBysQ_MoBwrHiuzL6dmEzWLYd6gKCv5-YoAPZwEAYEqzub3a_UXQOEckuOkwvQ9QeNNchHVDLZhY-amHrav4iJi8gf6jhc-VFu7RbWoen7BI0enhZbbGZenVO1mYX8RNmvXCLdUFcm3XvySgIG9LgcGqO4eLoxKYj4h_03O40wvvPNa8B5Pao83DwCX4p5D7V2EASnPSd6sjCVMDfiVKf6mo47MRaQmB2iqsU7sDohp8v6NgttFz_s-QVXrLGQbIQdCGFX0ZiGjE-ID4FHgCnk35dPSu5IaFC6I-IrbDpbyGTekXDbcTGtGgndrsyffbwUkln50lRoU6slVhpPKUzdXzH4iDfi0Bj-zWm_XwhxZiKR-2m00?></g></svg>