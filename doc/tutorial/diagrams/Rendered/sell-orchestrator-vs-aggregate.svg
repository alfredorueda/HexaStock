<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1356px" preserveAspectRatio="none" style="width:1022px;height:1356px;background:#FEFEFE;" version="1.1" viewBox="0 0 1022 1356" width="1022px" zoomAndPan="magnify"><title>Orchestrator vs Aggregate Root: Who Calls What?</title><defs/><g><rect fill="#FEFEFE" height="1356" style="stroke:none;stroke-width:1;" width="1022" x="0" y="0"/><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="621.4248" x="198.8474" y="35.4209">Orchestrator vs Aggregate Root: Who Calls What?</text><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="651.3203" style="stroke:#000000;stroke-width:1;" width="10" x="134.7725" y="173.4688"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="293.8594" style="stroke:#000000;stroke-width:1;" width="10" x="134.7725" y="897.0547"/></g><g><title>Portfolio</title><rect fill="#FFFFFF" height="651.3203" style="stroke:#000000;stroke-width:1;" width="10" x="372.9297" y="173.4688"/></g><g><title>Holding</title><rect fill="#FFFFFF" height="382.8594" style="stroke:#000000;stroke-width:1;" width="10" x="597.1816" y="355.5313"/></g><g><title>Holding</title><rect fill="#FFC0CB" height="139.9297" style="stroke:#000000;stroke-width:1;" width="10" x="597.1816" y="897.0547"/></g><g><title>Lot</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="859.7163" y="507.3281"/></g><g><title>Lot</title><rect fill="#FFFFFF" height="86.3984" style="stroke:#000000;stroke-width:1;" width="10" x="859.7163" y="565.5938"/></g><g><title>Lot</title><rect fill="#FFC0CB" height="124.7969" style="stroke:#000000;stroke-width:1;" width="10" x="859.7163" y="1066.1172"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Service" id="part1-lifeline"><g><title>PortfolioStockOperationsService</title><rect fill="#000000" fill-opacity="0.00000" height="1205.375" width="8" x="135.7725" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="139" x2="139" y1="99.2031" y2="1304.5781"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="Portfolio" id="part2-lifeline"><g><title>Portfolio</title><rect fill="#000000" fill-opacity="0.00000" height="1205.375" width="8" x="373.9297" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="377.4248" x2="377.4248" y1="99.2031" y2="1304.5781"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Holding" id="part3-lifeline"><g><title>Holding</title><rect fill="#000000" fill-opacity="0.00000" height="1205.375" width="8" x="598.1816" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="601.4224" x2="601.4224" y1="99.2031" y2="1304.5781"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="Lot" id="part4-lifeline"><g><title>Lot</title><rect fill="#000000" fill-opacity="0.00000" height="1205.375" width="8" x="860.7163" y="99.2031"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="863.8184" x2="863.8184" y1="99.2031" y2="1304.5781"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Service" id="part1-head"><rect fill="#ADD8E6" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="20" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="27" y="71.6045">PortfolioStockOperationsService</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145.3389" x="67.103" y="87.9014">(Application Service)</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Service" id="part1-tail"><rect fill="#ADD8E6" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="20" y="1303.5781"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="27" y="1323.5732">PortfolioStockOperationsService</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145.3389" x="67.103" y="1339.8701">(Application Service)</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="Portfolio" id="part2-head"><rect fill="#90EE90" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="135.0098" x="310.4248" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="58.0918" x="348.8838" y="71.6045">Portfolio</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.0098" x="317.4248" y="87.9014">(Aggregate Root)</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="Portfolio" id="part2-tail"><rect fill="#90EE90" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="135.0098" x="310.4248" y="1303.5781"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="58.0918" x="348.8838" y="1323.5732">Portfolio</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.0098" x="317.4248" y="1339.8701">(Aggregate Root)</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Holding" id="part3-head"><rect fill="#FFFFE0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="67.5186" x="568.4224" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="53.5186" x="575.4224" y="71.6045">Holding</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="51.7959" x="576.2837" y="87.9014">(Entity)</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Holding" id="part3-tail"><rect fill="#FFFFE0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="67.5186" x="568.4224" y="1303.5781"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="53.5186" x="575.4224" y="1323.5732">Holding</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="51.7959" x="576.2837" y="1339.8701">(Entity)</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="Lot" id="part4-head"><rect fill="#FFFFE0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="65.7959" x="831.8184" y="51.6094"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="21.8545" x="853.7891" y="71.6045">Lot</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="51.7959" x="838.8184" y="87.9014">(Entity)</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="Lot" id="part4-tail"><rect fill="#FFFFE0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="65.7959" x="831.8184" y="1303.5781"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="21.8545" x="853.7891" y="1323.5732">Lot</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="51.7959" x="838.8184" y="1339.8701">(Entity)</text></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="651.3203" style="stroke:#000000;stroke-width:1;" width="10" x="134.7725" y="173.4688"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="293.8594" style="stroke:#000000;stroke-width:1;" width="10" x="134.7725" y="897.0547"/></g><g><title>Portfolio</title><rect fill="#FFFFFF" height="651.3203" style="stroke:#000000;stroke-width:1;" width="10" x="372.9297" y="173.4688"/></g><g><title>Holding</title><rect fill="#FFFFFF" height="382.8594" style="stroke:#000000;stroke-width:1;" width="10" x="597.1816" y="355.5313"/></g><g><title>Holding</title><rect fill="#FFC0CB" height="139.9297" style="stroke:#000000;stroke-width:1;" width="10" x="597.1816" y="897.0547"/></g><g><title>Lot</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="859.7163" y="507.3281"/></g><g><title>Lot</title><rect fill="#FFFFFF" height="86.3984" style="stroke:#000000;stroke-width:1;" width="10" x="859.7163" y="565.5938"/></g><g><title>Lot</title><rect fill="#FFC0CB" height="124.7969" style="stroke:#000000;stroke-width:1;" width="10" x="859.7163" y="1066.1172"/></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1010.1196" x="5" y="129.7695"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1015.1196" y1="129.7695" y2="129.7695"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1015.1196" y1="132.7695" y2="132.7695"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="306.4556" x="356.832" y="119.2031"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="287.9297" x="362.832" y="135.27">&#9989; Correct: Service calls Aggregate Root</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#000000" points="360.9297,169.4688,370.9297,173.4688,360.9297,177.4688,364.9297,173.4688" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="144.7725" x2="366.9297" y1="173.4688" y2="173.4688"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="214.1572" x="151.7725" y="168.4028">sell(Ticker, ShareQuantity, Price)</text></g><path d="M149,186.4688 L149,256.4688 L294,256.4688 L294,196.4688 L284,186.4688 L149,186.4688" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M284,186.4688 L284,196.4688 L294,196.4688 L284,186.4688" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="124.814" x="155" y="203.5356">Application Service</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="93.0249" x="155" y="218.6685">orchestrates</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="21.5884" x="252.1572" y="218.6685">but</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="103.2954" x="155" y="233.8013">does NOT make</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="121.1514" x="155" y="248.9341">business decisions</text><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg2"><line style="stroke:#000000;stroke-width:1;" x1="382.9297" x2="424.9297" y1="313.3984" y2="313.3984"/><line style="stroke:#000000;stroke-width:1;" x1="424.9297" x2="424.9297" y1="313.3984" y2="326.3984"/><line style="stroke:#000000;stroke-width:1;" x1="383.9297" x2="424.9297" y1="326.3984" y2="326.3984"/><polygon fill="#000000" points="393.9297,322.3984,383.9297,326.3984,393.9297,330.3984,389.9297,326.3984" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="96.5415" x="389.9297" y="278.0669">validate inputs</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="138.6392" x="389.9297" y="293.1997">(quantity.isPositive(),</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="190.252" x="389.9297" y="308.3325">holdings.containsKey(ticker))</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg3"><polygon fill="#000000" points="585.1816,351.5313,595.1816,355.5313,585.1816,359.5313,589.1816,355.5313" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="382.9297" x2="591.1816" y1="355.5313" y2="355.5313"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166.3213" x="389.9297" y="350.4653">sell(ShareQuantity, Price)</text></g><path d="M387,368.5313 L387,438.5313 L547,438.5313 L547,378.5313 L537,368.5313 L387,368.5313" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M537,368.5313 L537,378.5313 L547,378.5313 L537,368.5313" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="102.2227" x="393" y="385.5981">Aggregate Root</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139.6675" x="393" y="400.731">protects invariants</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="109.7192" x="393" y="415.8638">and delegates to</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.7681" x="393" y="430.9966">controlled entities</text><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg4"><line style="stroke:#000000;stroke-width:1;" x1="607.1816" x2="649.1816" y1="465.1953" y2="465.1953"/><line style="stroke:#000000;stroke-width:1;" x1="649.1816" x2="649.1816" y1="465.1953" y2="478.1953"/><line style="stroke:#000000;stroke-width:1;" x1="608.1816" x2="649.1816" y1="478.1953" y2="478.1953"/><polygon fill="#000000" points="618.1816,474.1953,608.1816,478.1953,618.1816,482.1953,614.1816,478.1953" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="150.8267" x="614.1816" y="460.1294">check getTotalShares()</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg5"><polygon fill="#000000" points="847.7163,503.3281,857.7163,507.3281,847.7163,511.3281,851.7163,507.3281" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="607.1816" x2="853.7163" y1="507.3281" y2="507.3281"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="225.8496" x="614.1816" y="502.2622">calculateCostBasis(ShareQuantity)</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg6"><polygon fill="#000000" points="618.1816,532.4609,608.1816,536.4609,618.1816,540.4609,614.1816,536.4609" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="612.1816" x2="863.7163" y1="536.4609" y2="536.4609"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="43.1006" x="624.1816" y="531.395">Money</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg7"><polygon fill="#000000" points="847.7163,561.5938,857.7163,565.5938,847.7163,569.5938,851.7163,565.5938" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="607.1816" x2="853.7163" y1="565.5938" y2="565.5938"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="149.1001" x="614.1816" y="560.5278">reduce(ShareQuantity)</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg8"><line style="stroke:#000000;stroke-width:1;" x1="869.7163" x2="911.7163" y1="609.8594" y2="609.8594"/><line style="stroke:#000000;stroke-width:1;" x1="911.7163" x2="911.7163" y1="609.8594" y2="622.8594"/><line style="stroke:#000000;stroke-width:1;" x1="870.7163" x2="911.7163" y1="622.8594" y2="622.8594"/><polygon fill="#000000" points="880.7163,618.8594,870.7163,622.8594,880.7163,626.8594,876.7163,622.8594" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116.4033" x="876.7163" y="589.6606">validate &amp; update</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.5" x="876.7163" y="604.7935">remainingShares</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg9"><polygon fill="#000000" points="618.1816,647.9922,608.1816,651.9922,618.1816,655.9922,614.1816,651.9922" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="612.1816" x2="863.7163" y1="651.9922" y2="651.9922"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="27.5107" x="624.1816" y="646.9263">void</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg10"><line style="stroke:#000000;stroke-width:1;" x1="607.1816" x2="649.1816" y1="696.2578" y2="696.2578"/><line style="stroke:#000000;stroke-width:1;" x1="649.1816" x2="649.1816" y1="696.2578" y2="709.2578"/><line style="stroke:#000000;stroke-width:1;" x1="608.1816" x2="649.1816" y1="709.2578" y2="709.2578"/><polygon fill="#000000" points="618.1816,705.2578,608.1816,709.2578,618.1816,713.2578,614.1816,709.2578" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="148.8779" x="614.1816" y="676.0591">calculate SellResult.of(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="228.5347" x="614.1816" y="691.1919">Money proceeds, Money costBasis)</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg11"><polygon fill="#000000" points="393.9297,734.3906,383.9297,738.3906,393.9297,742.3906,389.9297,738.3906" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="387.9297" x2="601.1816" y1="738.3906" y2="738.3906"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="64.2256" x="399.9297" y="733.3247">SellResult</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg12"><line style="stroke:#000000;stroke-width:1;" x1="382.9297" x2="424.9297" y1="782.6563" y2="782.6563"/><line style="stroke:#000000;stroke-width:1;" x1="424.9297" x2="424.9297" y1="782.6563" y2="795.6563"/><line style="stroke:#000000;stroke-width:1;" x1="383.9297" x2="424.9297" y1="795.6563" y2="795.6563"/><polygon fill="#000000" points="393.9297,791.6563,383.9297,795.6563,393.9297,799.6563,389.9297,795.6563" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="155.1938" x="389.9297" y="762.4575">balance = balance.add(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116.1304" x="389.9297" y="777.5903">result.proceeds())</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg13"><polygon fill="#000000" points="150.7725,820.7891,140.7725,824.7891,150.7725,828.7891,146.7725,824.7891" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="144.7725" x2="376.9297" y1="824.7891" y2="824.7891"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="64.2256" x="156.7725" y="819.7231">SellResult</text></g><rect fill="#FFFFFF" height="3" style="stroke:#FFFFFF;stroke-width:1;" width="1010.1196" x="5" y="853.3555"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1015.1196" y1="853.3555" y2="853.3555"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1015.1196" y1="856.3555" y2="856.3555"/><rect fill="#FFFFFF" height="23.1328" style="stroke:#000000;stroke-width:1;" width="374.0073" x="323.0562" y="842.7891"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="355.4814" x="329.0562" y="858.856">&#10060; WRONG: Service directly manipulating entities</text><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg14"><line style="stroke:#FF0000;stroke-width:2;" x1="579.1816" x2="589.1816" y1="892.0547" y2="902.0547"/><line style="stroke:#FF0000;stroke-width:2;" x1="579.1816" x2="589.1816" y1="902.0547" y2="892.0547"/><line style="stroke:#FF0000;stroke-width:1;" x1="144.7725" x2="584.1816" y1="897.0547" y2="897.0547"/><text fill="#FF0000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="58.5571" x="151.7725" y="891.9888">getLots()</text></g><path d="M149,910.0547 L149,1010.0547 L313,1010.0547 L313,920.0547 L303,910.0547 L149,910.0547" fill="#FFC0CB" style="stroke:#000000;stroke-width:1;"/><path d="M303,910.0547 L303,920.0547 L313,920.0547 L303,910.0547" fill="#FFC0CB" style="stroke:#000000;stroke-width:1;"/><text fill="#FF0000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113.0645" x="155" y="927.1216">ANTI-PATTERN!</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="155" y="942.2544">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="143.457" x="155" y="957.3872">Service should NEVER</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="126.5342" x="155" y="972.52">directly manipulate</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116.5112" x="155" y="987.6528">entities inside the</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="72.3379" x="155" y="1002.7856">aggregate!</text><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg15"><polygon fill="#FF0000" points="155.7725,1032.9844,145.7725,1036.9844,155.7725,1040.9844,151.7725,1036.9844" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;stroke-dasharray:2,2;" x1="149.7725" x2="601.1816" y1="1036.9844" y2="1036.9844"/><text fill="#FF0000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="64.8032" x="161.7725" y="1031.9185">List&lt;Lot&gt;</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg16"><line style="stroke:#FF0000;stroke-width:2;" x1="841.7163" x2="851.7163" y1="1061.1172" y2="1071.1172"/><line style="stroke:#FF0000;stroke-width:2;" x1="841.7163" x2="851.7163" y1="1071.1172" y2="1061.1172"/><line style="stroke:#FF0000;stroke-width:1;" x1="144.7725" x2="846.7163" y1="1066.1172" y2="1066.1172"/><text fill="#FF0000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="149.1001" x="151.7725" y="1061.0513">reduce(ShareQuantity)</text></g><path d="M149,1079.1172 L149,1164.1172 L286,1164.1172 L286,1089.1172 L276,1079.1172 L149,1079.1172" fill="#FFC0CB" style="stroke:#000000;stroke-width:1;"/><path d="M276,1079.1172 L276,1089.1172 L286,1089.1172 L276,1079.1172" fill="#FFC0CB" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="116.6445" x="155" y="1096.1841">This bypasses the</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="102.8193" x="155" y="1111.3169">aggregate root!</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="155" y="1126.4497">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112.6328" x="155" y="1141.5825">Invariants can be</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="57.3955" x="155" y="1156.7153">violated!</text><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg17"><polygon fill="#FF0000" points="150.7725,1186.9141,140.7725,1190.9141,150.7725,1194.9141,146.7725,1190.9141" style="stroke:#FF0000;stroke-width:1;"/><line style="stroke:#FF0000;stroke-width:1;stroke-dasharray:2,2;" x1="144.7725" x2="863.7163" y1="1190.9141" y2="1190.9141"/><text fill="#FF0000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="27.5107" x="156.7725" y="1185.8481">void</text></g><path d="M55,1203.9141 L55,1288.9141 L947,1288.9141 L947,1213.9141 L937,1203.9141 L55,1203.9141" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M937,1203.9141 L937,1213.9141 L947,1213.9141 L937,1203.9141" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="74.6357" x="341.1626" y="1220.981">DDD Rule:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="296.4419" x="341.1626" y="1236.1138">External code (including application services)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="311.2891" x="341.1626" y="1251.2466">must ONLY call methods on the aggregate root.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="341.1626" y="1266.3794">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.8428" x="341.1626" y="1281.5122">Nested entities are</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="74.4834" x="469.1377" y="1281.5122">controlled</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="76.0259" x="547.7534" y="1281.5122">by the root.</text><?plantuml-src ZLNRRXit47tVhnZ7G249ilfkM2uSMqc3gf8Y2ms2kWyKETOIeiWjoLMZ3-XRFg7zkNv9Xzox9CU1_R0YPywSENFXXKznXv0f9dNYjb9dpB8Th1dVRgp9jRWtobYuV3S9VucNNY7CBK_HUSiyNUqTt6qs5ZVC8ooDyTVmAJLmpvHozCNyJqb2e5vocJ7juSt2MFzib3IFtl3jF4F2aKQxHxHxoV59z-woJ4aUJw4yxRy1vgeVS3cLczI_LJc-01r0EgGA__g-H7Xl4NKNucUZXDGR0fXeolPGE9QdfTjdLChyrVMR6d_aGoTT-sGyXl_--HlkZRN8IQSg7HwrwXA6yJX9AeEhsuRwDJY2wwqatw8TmcFAB7xCMGmyX8KDOYMCUxaFK2L2Sr3Z9DhGJnluWNck3G7Eg4-dWu6fguvkC81rxkbO67GmcwzWnxR1R9qxgT4v4CYb2sLDK0i8iPAaaR-Rq9ufAG8vQh_SEzBnppAXaNGBuoHnnrv_-AJJeWvkn8tsrBBk5ppqV9IYt-_YboKhvNf5fjBuI9D6ApYgJXGaisJDlIFQUsObOPCkTCCeOO4gMZlmmJlGjKOf5821WiIsBbLtjLcJrdmB6_GhuvcAz5sltpQTXb6Zrk6vea3tnlctp4dNJRML8zadeIUlsc5-DHeFYS2ErKaKYoBd-3foQLxNymV8i_3nf2tkg5o4MMHoIcHlfFWMZqQOAcDgJgMMw7BbH-QvzwHZBa1LuOZ23OlSIFfIc9PutVPhSDe4gfPuiMlNJ35DmpcklaPCY5v8DLAgUFIwZKaOvL2z5BZfkjPXDOXnX_px5JujvxFtpGOHCcmKTQ0nr38ByeGygrRhxfBVBwcSVtnf5BrvfkuadMZHZ-dgbfgEr2VYDp-6czjlR9DwBowatfxVAEKTd8GP3EvcgmzNYxlLQhASNGm6LJW0-g-yNMfo9M0s-Mso3Flc9D6mTUf4QID8WK2FMfZ3QcGlcbchMw1GeLsDOtvJwVmD2N5RyJhN72UgnW4uXZexFoVgnWVZEuHSfTB1-f0nvy9-wUOAbjRJHQ7XXtelqTHeM0V3lJH1DD7I9CxYwtg42JqZHHZKSuqQSp1xjDNHC9g6nVdmy03BNE5rN9UJBnwjPef2KUbwKdELnngnraFa2WmQOe1TxZpCPzFFyU647VhK20TaHLeSAJ4gb9ZHmzNQlK1r81xDLWxlsI6w5qwrDly3?></g></svg>