<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1290px" preserveAspectRatio="none" style="width:2033px;height:1290px;background:#FEFEFE;" version="1.1" viewBox="0 0 2033 1290" width="2033px" zoomAndPan="magnify"><defs/><g><rect fill="#FEFEFE" height="1290" style="stroke:none;stroke-width:1;" width="2033" x="0" y="0"/><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="952.1797" style="stroke:#000000;stroke-width:1;" width="10" x="545.1484" y="128.5625"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="569.7891" style="stroke:#000000;stroke-width:1;" width="10" x="858.3711" y="245.2266"/></g><g><title>Portfolio</title><rect fill="#FFFFFF" height="412.125" style="stroke:#000000;stroke-width:1;" width="10" x="1145.1348" y="373.7578"/></g><g><title>Holding</title><rect fill="#FFFFFF" height="269.5938" style="stroke:#000000;stroke-width:1;" width="10" x="1421.5327" y="487.1563"/></g><g><title>GlobalExceptionHandler</title><rect fill="#FFFFFF" height="131.7969" style="stroke:#000000;stroke-width:1;" width="10" x="1779.2822" y="844.1484"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Client" id="part1-lifeline"><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="1127.2422" width="8" x="65.2651" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="69" x2="69" y1="82.2969" y2="1209.5391"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="Controller" id="part2-lifeline"><g><title>PortfolioRestController</title><rect fill="#000000" fill-opacity="0.00000" height="1127.2422" width="8" x="546.1484" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="549.9541" x2="549.9541" y1="82.2969" y2="1209.5391"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Service" id="part3-lifeline"><g><title>PortfolioStockOperationsService</title><rect fill="#000000" fill-opacity="0.00000" height="1127.2422" width="8" x="859.3711" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="862.5986" x2="862.5986" y1="82.2969" y2="1209.5391"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="Portfolio" id="part4-lifeline"><g><title>Portfolio</title><rect fill="#000000" fill-opacity="0.00000" height="1127.2422" width="8" x="1146.1348" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1150.0889" x2="1150.0889" y1="82.2969" y2="1209.5391"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="Holding" id="part5-lifeline"><g><title>Holding</title><rect fill="#000000" fill-opacity="0.00000" height="1127.2422" width="8" x="1422.5327" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1425.7734" x2="1425.7734" y1="82.2969" y2="1209.5391"/></g></g><g class="participant-lifeline" data-entity-uid="part6" data-qualified-name="Handler" id="part6-lifeline"><g><title>GlobalExceptionHandler</title><rect fill="#000000" fill-opacity="0.00000" height="1127.2422" width="8" x="1780.2822" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1783.8174" x2="1783.8174" y1="82.2969" y2="1209.5391"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Client" id="part1-head"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="46" y="78.9951">Client</text><ellipse cx="69.2651" cy="14" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M69.2651,22 L69.2651,49 M56.2651,30 L82.2651,30 M69.2651,49 L56.2651,64 M69.2651,49 L82.2651,64" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Client" id="part1-tail"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="46" y="1221.5342">Client</text><ellipse cx="69.2651" cy="1233.8359" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M69.2651,1241.8359 L69.2651,1268.8359 M56.2651,1249.8359 L82.2651,1249.8359 M69.2651,1268.8359 L56.2651,1283.8359 M69.2651,1268.8359 L82.2651,1283.8359" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="Controller" id="part2-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="463.9541" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="470.9541" y="70.9951">PortfolioRestController</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="Controller" id="part2-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="463.9541" y="1208.5391"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="470.9541" y="1228.5342">PortfolioRestController</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Service" id="part3-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="743.5986" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="750.5986" y="70.9951">PortfolioStockOperationsService</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Service" id="part3-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="743.5986" y="1208.5391"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="750.5986" y="1228.5342">PortfolioStockOperationsService</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="Portfolio" id="part4-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="72.0918" x="1114.0889" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="58.0918" x="1121.0889" y="70.9951">Portfolio</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="Portfolio" id="part4-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="72.0918" x="1114.0889" y="1208.5391"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="58.0918" x="1121.0889" y="1228.5342">Portfolio</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="Holding" id="part5-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="67.5186" x="1392.7734" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="53.5186" x="1399.7734" y="70.9951">Holding</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="Holding" id="part5-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="67.5186" x="1392.7734" y="1208.5391"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="53.5186" x="1399.7734" y="1228.5342">Holding</text></g><g class="participant participant-head" data-entity-uid="part6" data-qualified-name="Handler" id="part6-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="182.9297" x="1692.8174" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="168.9297" x="1699.8174" y="70.9951">GlobalExceptionHandler</text></g><g class="participant participant-tail" data-entity-uid="part6" data-qualified-name="Handler" id="part6-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="182.9297" x="1692.8174" y="1208.5391"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="168.9297" x="1699.8174" y="1228.5342">GlobalExceptionHandler</text></g><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="952.1797" style="stroke:#000000;stroke-width:1;" width="10" x="545.1484" y="128.5625"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="569.7891" style="stroke:#000000;stroke-width:1;" width="10" x="858.3711" y="245.2266"/></g><g><title>Portfolio</title><rect fill="#FFFFFF" height="412.125" style="stroke:#000000;stroke-width:1;" width="10" x="1145.1348" y="373.7578"/></g><g><title>Holding</title><rect fill="#FFFFFF" height="269.5938" style="stroke:#000000;stroke-width:1;" width="10" x="1421.5327" y="487.1563"/></g><g><title>GlobalExceptionHandler</title><rect fill="#FFFFFF" height="131.7969" style="stroke:#000000;stroke-width:1;" width="10" x="1779.2822" y="844.1484"/></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#000000" points="533.1484,124.5625,543.1484,128.5625,533.1484,132.5625,537.1484,128.5625" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="69.2651" x2="539.1484" y1="128.5625" y2="128.5625"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="222.8662" x="76.2651" y="108.3638">POST /api/portfolios/abc-123/sales</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="218.0483" x="76.2651" y="123.4966">{"ticker":"AAPL", "quantity":100}</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg2"><line style="stroke:#000000;stroke-width:1;" x1="555.1484" x2="597.1484" y1="203.0938" y2="203.0938"/><line style="stroke:#000000;stroke-width:1;" x1="597.1484" x2="597.1484" y1="203.0938" y2="216.0938"/><line style="stroke:#000000;stroke-width:1;" x1="556.1484" x2="597.1484" y1="216.0938" y2="216.0938"/><polygon fill="#000000" points="566.1484,212.0938,556.1484,216.0938,566.1484,220.0938,562.1484,216.0938" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141.9463" x="562.1484" y="152.6294">Create Value Objects:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="157.6631" x="562.1484" y="167.7622">PortfolioId.of("abc-123")</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="111.2046" x="562.1484" y="182.895">Ticker.of("AAPL")</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="184.0566" x="562.1484" y="198.0278">ShareQuantity.positive(100)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg3"><polygon fill="#000000" points="846.3711,241.2266,856.3711,245.2266,846.3711,249.2266,850.3711,245.2266" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="555.1484" x2="852.3711" y1="245.2266" y2="245.2266"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="284.2227" x="562.1484" y="240.1606">sellStock(PortfolioId, Ticker, ShareQuantity)</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg4"><line style="stroke:#000000;stroke-width:1;" x1="868.3711" x2="910.3711" y1="289.4922" y2="289.4922"/><line style="stroke:#000000;stroke-width:1;" x1="910.3711" x2="910.3711" y1="289.4922" y2="302.4922"/><line style="stroke:#000000;stroke-width:1;" x1="869.3711" x2="910.3711" y1="302.4922" y2="302.4922"/><polygon fill="#000000" points="879.3711,298.4922,869.3711,302.4922,879.3711,306.4922,875.3711,302.4922" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91.5459" x="875.3711" y="269.2935">fetch portfolio</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="252.7637" x="875.3711" y="284.4263">(owns ShareQuantity(10) AAPL shares)</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg5"><line style="stroke:#000000;stroke-width:1;" x1="868.3711" x2="910.3711" y1="331.625" y2="331.625"/><line style="stroke:#000000;stroke-width:1;" x1="910.3711" x2="910.3711" y1="331.625" y2="344.625"/><line style="stroke:#000000;stroke-width:1;" x1="869.3711" x2="910.3711" y1="344.625" y2="344.625"/><polygon fill="#000000" points="879.3711,340.625,869.3711,344.625,879.3711,348.625,875.3711,344.625" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="120.6436" x="875.3711" y="326.5591">fetch price &#8594; Price</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg6"><polygon fill="#000000" points="1133.1348,369.7578,1143.1348,373.7578,1133.1348,377.7578,1137.1348,373.7578" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="868.3711" x2="1139.1348" y1="373.7578" y2="373.7578"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="249.1138" x="875.3711" y="368.6919">sell(Ticker, ShareQuantity(100), Price)</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg7"><line style="stroke:#000000;stroke-width:1;" x1="1155.1348" x2="1197.1348" y1="402.8906" y2="402.8906"/><line style="stroke:#000000;stroke-width:1;" x1="1197.1348" x2="1197.1348" y1="402.8906" y2="415.8906"/><line style="stroke:#000000;stroke-width:1;" x1="1156.1348" x2="1197.1348" y1="415.8906" y2="415.8906"/><polygon fill="#000000" points="1166.1348,411.8906,1156.1348,415.8906,1166.1348,419.8906,1162.1348,415.8906" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="200.7891" x="1162.1348" y="397.8247">validate quantity.isPositive() &#10003;</text></g><g class="message" data-entity-1="part4" data-entity-2="part4" id="msg8"><line style="stroke:#000000;stroke-width:1;" x1="1155.1348" x2="1197.1348" y1="445.0234" y2="445.0234"/><line style="stroke:#000000;stroke-width:1;" x1="1197.1348" x2="1197.1348" y1="445.0234" y2="458.0234"/><line style="stroke:#000000;stroke-width:1;" x1="1156.1348" x2="1197.1348" y1="458.0234" y2="458.0234"/><polygon fill="#000000" points="1166.1348,454.0234,1156.1348,458.0234,1166.1348,462.0234,1162.1348,458.0234" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="242.3979" x="1162.1348" y="439.9575">check holdings.containsKey(ticker) &#10003;</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg9"><polygon fill="#000000" points="1409.5327,483.1563,1419.5327,487.1563,1409.5327,491.1563,1413.5327,487.1563" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="1155.1348" x2="1415.5327" y1="487.1563" y2="487.1563"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.2778" x="1162.1348" y="482.0903">sell(ShareQuantity(100), Price)</text></g><g class="message" data-entity-1="part5" data-entity-2="part5" id="msg10"><line style="stroke:#000000;stroke-width:1;" x1="1431.5327" x2="1473.5327" y1="516.2891" y2="516.2891"/><line style="stroke:#000000;stroke-width:1;" x1="1473.5327" x2="1473.5327" y1="516.2891" y2="529.2891"/><line style="stroke:#000000;stroke-width:1;" x1="1432.5327" x2="1473.5327" y1="529.2891" y2="529.2891"/><polygon fill="#000000" points="1442.5327,525.2891,1432.5327,529.2891,1442.5327,533.2891,1438.5327,529.2891" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="323.7495" x="1438.5327" y="511.2231">check getTotalShares().value() &lt; quantity.value()</text></g><path d="M1436,542.2891 L1436,657.2891 L1705,657.2891 L1705,552.2891 L1695,542.2891 L1436,542.2891" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1695,542.2891 L1695,552.2891 L1705,552.2891 L1695,542.2891" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="91.0317" x="1442" y="559.356">Business rule:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.792" x="1442" y="574.4888">Cannot sell more</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="123.9761" x="1442" y="589.6216">shares than owned</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="1442" y="604.7544">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="248.4536" x="1442" y="619.8872">getTotalShares() = ShareQuantity(10)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="202.2871" x="1442" y="635.02">quantity = ShareQuantity(100)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="107.1167" x="1442" y="650.1528">10 &lt; 100 &#8594; FAIL</text><g class="message" data-entity-1="part5" data-entity-2="part5" id="msg11"><line style="stroke:#000000;stroke-width:1;" x1="1431.5327" x2="1473.5327" y1="714.6172" y2="714.6172"/><line style="stroke:#000000;stroke-width:1;" x1="1473.5327" x2="1473.5327" y1="714.6172" y2="727.6172"/><line style="stroke:#000000;stroke-width:1;" x1="1432.5327" x2="1473.5327" y1="727.6172" y2="727.6172"/><polygon fill="#000000" points="1442.5327,723.6172,1432.5327,727.6172,1442.5327,731.6172,1438.5327,727.6172" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="216.1694" x="1438.5327" y="679.2856">throw ConflictQuantityException(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="176.4775" x="1438.5327" y="694.4185">"Not enough shares to sell.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206.9399" x="1438.5327" y="709.5513">Available: 10, Requested: 100")</text></g><g class="message" data-entity-1="part5" data-entity-2="part4" id="msg12"><polygon fill="#000000" points="1166.1348,752.75,1156.1348,756.75,1166.1348,760.75,1162.1348,756.75" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="1160.1348" x2="1425.5327" y1="756.75" y2="756.75"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="211.0977" x="1172.1348" y="751.6841">throw ConflictQuantityException</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg13"><polygon fill="#000000" points="879.3711,781.8828,869.3711,785.8828,879.3711,789.8828,875.3711,785.8828" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="873.3711" x2="1149.1348" y1="785.8828" y2="785.8828"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="211.0977" x="885.3711" y="780.8169">throw ConflictQuantityException</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg14"><polygon fill="#000000" points="566.1484,811.0156,556.1484,815.0156,566.1484,819.0156,562.1484,815.0156" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="560.1484" x2="862.3711" y1="815.0156" y2="815.0156"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="211.0977" x="572.1484" y="809.9497">throw ConflictQuantityException</text></g><g class="message" data-entity-1="part2" data-entity-2="part6" id="msg15"><polygon fill="#000000" points="1767.2822,840.1484,1777.2822,844.1484,1767.2822,848.1484,1771.2822,844.1484" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="555.1484" x2="1773.2822" y1="844.1484" y2="844.1484"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112.4297" x="562.1484" y="839.0825">handle exception</text></g><g class="message" data-entity-1="part6" data-entity-2="part6" id="msg16"><line style="stroke:#000000;stroke-width:1;" x1="1789.2822" x2="1831.2822" y1="933.8125" y2="933.8125"/><line style="stroke:#000000;stroke-width:1;" x1="1831.2822" x2="1831.2822" y1="933.8125" y2="946.8125"/><line style="stroke:#000000;stroke-width:1;" x1="1790.2822" x2="1831.2822" y1="946.8125" y2="946.8125"/><polygon fill="#000000" points="1800.2822,942.8125,1790.2822,946.8125,1800.2822,950.8125,1796.2822,946.8125" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.0225" x="1796.2822" y="868.2153">create ProblemDetail:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="82.0942" x="1796.2822" y="883.3481">- status: 409</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="164.3345" x="1796.2822" y="898.481">- title: "Conflict Quantity"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="230.3501" x="1796.2822" y="913.6138">- detail: "Not enough shares to sell.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.8682" x="1796.2822" y="928.7466">Available: 10, Requested: 100"</text></g><g class="message" data-entity-1="part6" data-entity-2="part2" id="msg17"><polygon fill="#000000" points="566.1484,971.9453,556.1484,975.9453,566.1484,979.9453,562.1484,975.9453" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="560.1484" x2="1783.2822" y1="975.9453" y2="975.9453"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="214.7158" x="572.1484" y="970.8794">ResponseEntity&lt;ProblemDetail&gt;</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg18"><polygon fill="#000000" points="80.2651,1076.7422,70.2651,1080.7422,80.2651,1084.7422,76.2651,1080.7422" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="74.2651" x2="549.1484" y1="1080.7422" y2="1080.7422"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="131.1807" x="86.2651" y="1000.0122">HTTP 409 CONFLICT</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="86.2651" y="1015.145">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="171.6025" x="94.5298" y="1030.2778">"title": "Conflict Quantity",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="443.6187" x="94.5298" y="1045.4106">"detail": "Not enough shares to sell. Available: 10, Requested: 100",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="85.23" x="94.5298" y="1060.5435">"status": 409</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="86.2651" y="1075.6763">}</text></g><path d="M10,1093.7422 L10,1193.7422 L1844,1193.7422 L1844,1103.7422 L1834,1093.7422 L10,1093.7422" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1834,1093.7422 L1834,1103.7422 L1844,1103.7422 L1834,1093.7422" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="242.3979" x="789.1602" y="1110.8091">Domain Exception &#8594; HTTP Status</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="267.1157" x="789.1602" y="1125.9419">ConflictQuantityException &#8594; 409 Conflict</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="789.1602" y="1141.0747">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="267.4268" x="789.1602" y="1156.2075">The Holding entity protects this invariant</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="224.1675" x="789.1602" y="1171.3403">using ShareQuantity comparisons.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="265.7891" x="789.1602" y="1186.4731">The aggregate root delegates the check.</text><?plantuml-src fLNDRXCn4BxlKmpcabHfcW8NLe1KGaihAXf8n2aNPtUoQ-BOY-sa8CIL1u0hJyUJCFR-P3Uq1OIImzWxyyttZSVZUox7DK8XkL2HNGbLSCFNiE39AZDwezAnbjh0_RDJ_uiYdZXQZgL0vIBoTI8H1LSEs4GRjzHIwBTetLWhPxIKQ1Xm2xlbBJ5JfvFLLO66Ew6LdQBPYWH3R6NV4XXScbNNwLpBLAWik5Hsr-6br0ikJpycMFYqvrobDUFAZg9IAXm-Quc8ON8rdS4HByHHKUUsHtoH71u_U7XakKGxLvyPPLeHNinEJYQNR03imuRo2lU9nSUZqHTVJB7b3jlrYNRsVjAnGU_yZiiDmjNYFIREndFLgBz8XthPOnKDrf-hMI0GTWC5sfhctE2RYiUmq5OG1-mHd_v-xghoCLYKCfnGhvLh02Nw03gG_Psg-kIYokXWBj4bEJJLcwkUlbQsYqMi-k29W_NRjdyNal7xFxz-WudPJzgmBgNqRYGUIZ0eeriYThqLDUOUvfPBaNhV-dY7maxgmlRXvu_ljuOcEIOhoClcjCE4wayNqRx2JxsoUShmRdpLovMOln5HTtzK6HsKaaE6RgOTbm7Ezlh3hMypelza9wlQYfGcJ2Eot85UDk00ppTMABGMp4PYJ1jZhiWty8IrDaXRvKc2oxa2Ed5CQO_---dXwU-jG6urbHi-X-_78-9BTcY4ivEBomXL2fxlpTfTRlIrlsHBAH9NepKJeJTNx3K9GAKtMTvmrq7HSAvEjbn8lY2nb7G0R_73XeOVfduvOlrMpkwn_o5jbEBlHzTgWNRt_mDKgvMRox4tOlu1hRdTtQ5H3SuOyc00Dh4xIVLihOnEM58EkOdHLDRr2wJx86d87O9rt6ri38z6Z_sIUFcoivehr6IP_vgMSV0VfzUYjrSaUk0AUgJmDEHxqg7wh7DspIFIAf472szA3EUpsSJhWV7LwxFBY_6C7esv0c117BjHtI0ubFhOdGBXRdqbK5bLLfNrIvjz-r4ADrvliNxw1uqsW8E35tfDKmkQDWctBuYR1lY30pyBRckgu1sgK7cK4s6MDyrF0iEbBmpHe4UFsbHO46hBZI0mSlQ39-kE14ZqcbvxOUceXXKUppA3cHTdDDKjHHbM7X3BEJZS3OnV?></g></svg>