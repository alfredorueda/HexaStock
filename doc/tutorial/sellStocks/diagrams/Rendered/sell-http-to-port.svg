<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="810px" preserveAspectRatio="none" style="width:1188px;height:810px;background:#FEFEFE;" version="1.1" viewBox="0 0 1188 810" width="1188px" zoomAndPan="magnify"><defs/><g><rect fill="#FEFEFE" height="810" style="stroke:none;stroke-width:1;" width="1188" x="0" y="0"/><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="501.7891" style="stroke:#000000;stroke-width:1;" width="10" x="431.3833" y="128.5625"/></g><g><title>PortfolioStockOperationsUseCase</title><rect fill="#FFFFFF" height="135.7969" style="stroke:#000000;stroke-width:1;" width="10" x="744.606" y="377.8906"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="1057.8286" y="455.4219"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Client" id="part1-lifeline"><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="646.5859" width="8" x="29.2651" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="33" x2="33" y1="82.2969" y2="728.8828"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="Controller" id="part2-lifeline"><g><title>PortfolioRestController</title><rect fill="#000000" fill-opacity="0.00000" height="646.5859" width="8" x="432.3833" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="436.189" x2="436.189" y1="82.2969" y2="728.8828"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Port" id="part3-lifeline"><g><title>PortfolioStockOperationsUseCase</title><rect fill="#000000" fill-opacity="0.00000" height="646.5859" width="8" x="745.606" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="749.4961" x2="749.4961" y1="82.2969" y2="728.8828"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="Service" id="part4-lifeline"><g><title>PortfolioStockOperationsService</title><rect fill="#000000" fill-opacity="0.00000" height="646.5859" width="8" x="1058.8286" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1062.0562" x2="1062.0562" y1="82.2969" y2="728.8828"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Client" id="part1-head"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="10" y="78.9951">Client</text><ellipse cx="33.2651" cy="14" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M33.2651,22 L33.2651,49 M20.2651,30 L46.2651,30 M33.2651,49 L20.2651,64 M33.2651,49 L46.2651,64" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Client" id="part1-tail"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="10" y="740.8779">Client</text><ellipse cx="33.2651" cy="753.1797" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M33.2651,761.1797 L33.2651,788.1797 M20.2651,769.1797 L46.2651,769.1797 M33.2651,788.1797 L20.2651,803.1797 M33.2651,788.1797 L46.2651,803.1797" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="Controller" id="part2-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="350.189" y="34.7031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="357.189" y="54.6982">PortfolioRestController</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.5225" x="375.6221" y="70.9951">(Driving Adapter)</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="Controller" id="part2-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="350.189" y="727.8828"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="357.189" y="747.8779">PortfolioRestController</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="121.5225" x="375.6221" y="764.1748">(Driving Adapter)</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Port" id="part3-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="248.2197" x="625.4961" y="34.7031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="234.2197" x="632.4961" y="54.6982">PortfolioStockOperationsUseCase</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="97.9727" x="700.6196" y="70.9951">(Primary Port)</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Port" id="part3-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="248.2197" x="625.4961" y="727.8828"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="234.2197" x="632.4961" y="747.8779">PortfolioStockOperationsUseCase</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="97.9727" x="700.6196" y="764.1748">(Primary Port)</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="Service" id="part4-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="943.0562" y="34.7031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="950.0562" y="54.6982">PortfolioStockOperationsService</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145.3389" x="990.1592" y="70.9951">(Application Service)</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="Service" id="part4-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="943.0562" y="727.8828"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="950.0562" y="747.8779">PortfolioStockOperationsService</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="145.3389" x="990.1592" y="764.1748">(Application Service)</text></g><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="501.7891" style="stroke:#000000;stroke-width:1;" width="10" x="431.3833" y="128.5625"/></g><g><title>PortfolioStockOperationsUseCase</title><rect fill="#FFFFFF" height="135.7969" style="stroke:#000000;stroke-width:1;" width="10" x="744.606" y="377.8906"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="1057.8286" y="455.4219"/></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#000000" points="419.3833,124.5625,429.3833,128.5625,419.3833,132.5625,423.3833,128.5625" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="33.2651" x2="425.3833" y1="128.5625" y2="128.5625"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="198.4023" x="40.2651" y="108.3638">POST /api/portfolios/{id}/sales</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.5063" x="40.2651" y="123.4966">{"ticker":"AAPL", "quantity":5}</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg2"><line style="stroke:#000000;stroke-width:1;" x1="441.3833" x2="483.3833" y1="157.6953" y2="157.6953"/><line style="stroke:#000000;stroke-width:1;" x1="483.3833" x2="483.3833" y1="157.6953" y2="170.6953"/><line style="stroke:#000000;stroke-width:1;" x1="442.3833" x2="483.3833" y1="170.6953" y2="170.6953"/><polygon fill="#000000" points="452.3833,166.6953,442.3833,170.6953,452.3833,174.6953,448.3833,170.6953" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="157.1997" x="448.3833" y="152.6294">Extract path variable: id</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg3"><line style="stroke:#000000;stroke-width:1;" x1="441.3833" x2="483.3833" y1="199.8281" y2="199.8281"/><line style="stroke:#000000;stroke-width:1;" x1="483.3833" x2="483.3833" y1="199.8281" y2="212.8281"/><line style="stroke:#000000;stroke-width:1;" x1="442.3833" x2="483.3833" y1="212.8281" y2="212.8281"/><polygon fill="#000000" points="452.3833,208.8281,442.3833,212.8281,452.3833,216.8281,448.3833,212.8281" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="243.9531" x="448.3833" y="194.7622">Parse request body: SaleRequestDTO</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg4"><line style="stroke:#000000;stroke-width:1;" x1="441.3833" x2="483.3833" y1="287.3594" y2="287.3594"/><line style="stroke:#000000;stroke-width:1;" x1="483.3833" x2="483.3833" y1="287.3594" y2="300.3594"/><line style="stroke:#000000;stroke-width:1;" x1="442.3833" x2="483.3833" y1="300.3594" y2="300.3594"/><polygon fill="#000000" points="452.3833,296.3594,442.3833,300.3594,452.3833,304.3594,448.3833,300.3594" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141.9463" x="448.3833" y="236.895">Create Value Objects:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="104.6982" x="448.3833" y="252.0278">PortfolioId.of(id)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="111.2046" x="448.3833" y="267.1606">Ticker.of("AAPL")</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.5146" x="448.3833" y="282.2935">ShareQuantity.positive(5)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg5"><polygon fill="#000000" points="732.606,373.8906,742.606,377.8906,732.606,381.8906,736.606,377.8906" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="441.3833" x2="738.606" y1="377.8906" y2="377.8906"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="284.2227" x="448.3833" y="372.8247">sellStock(PortfolioId, Ticker, ShareQuantity)</text></g><path d="M759,313.3594 L759,428.3594 L1015,428.3594 L1015,323.3594 L1005,313.3594 L759,313.3594" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1005,313.3594 L1005,323.3594 L1015,323.3594 L1005,313.3594" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169.9204" x="765" y="330.4263">Controller depends on the</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66.1045" x="765" y="345.5591">interface</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166.2896" x="831.1045" y="345.5591">, not the implementation.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="194.9937" x="765" y="360.6919">This is Dependency Inversion.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="765" y="375.8247">&#160;</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="121.0942" x="765" y="390.9575">All parameters are</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101.1753" x="890.2266" y="390.9575">Value Objects</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="991.4019" y="390.9575">,</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="235.9932" x="765" y="406.0903">not primitives. Type safety prevents</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="223.2915" x="765" y="421.2231">accidentally swapping arguments.</text><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg7"><polygon fill="#000000" points="1045.8286,451.4219,1055.8286,455.4219,1045.8286,459.4219,1049.8286,455.4219" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="754.606" x2="1051.8286" y1="455.4219" y2="455.4219"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="284.2227" x="761.606" y="450.356">sellStock(PortfolioId, Ticker, ShareQuantity)</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg8"><polygon fill="#000000" points="765.606,480.5547,755.606,484.5547,765.606,488.5547,761.606,484.5547" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="759.606" x2="1061.8286" y1="484.5547" y2="484.5547"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="64.2256" x="771.606" y="479.4888">SellResult</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg9"><polygon fill="#000000" points="452.3833,509.6875,442.3833,513.6875,452.3833,517.6875,448.3833,513.6875" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="446.3833" x2="748.606" y1="513.6875" y2="513.6875"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="64.2256" x="458.3833" y="508.6216">SellResult</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg10"><line style="stroke:#000000;stroke-width:1;" x1="441.3833" x2="483.3833" y1="573.0859" y2="573.0859"/><line style="stroke:#000000;stroke-width:1;" x1="483.3833" x2="483.3833" y1="573.0859" y2="586.0859"/><line style="stroke:#000000;stroke-width:1;" x1="442.3833" x2="483.3833" y1="586.0859" y2="586.0859"/><polygon fill="#000000" points="452.3833,582.0859,442.3833,586.0859,452.3833,590.0859,448.3833,586.0859" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="105.2822" x="448.3833" y="537.7544">Convert to DTO:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="119.0313" x="448.3833" y="552.8872">SaleResponseDTO</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="223.0884" x="448.3833" y="568.02">(extracts BigDecimal from Money)</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg11"><polygon fill="#000000" points="44.2651,626.3516,34.2651,630.3516,44.2651,634.3516,40.2651,630.3516" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="38.2651" x2="435.3833" y1="630.3516" y2="630.3516"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="85.3315" x="50.2651" y="610.1528">HTTP 200 OK</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="374.1182" x="50.2651" y="625.2856">{"proceeds":750.00, "costBasis":625.00, "profit":125.00}</text></g><path d="M302,643.3516 L302,713.3516 L568,713.3516 L568,653.3516 L558,643.3516 L302,643.3516" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M558,643.3516 L558,653.3516 L568,653.3516 L558,643.3516" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.2285" x="308" y="660.4185">The controller is a</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="116.562" x="429.3608" y="660.4185">Driving Adapter</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="4.1323" x="545.9229" y="660.4185">.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="213.3828" x="308" y="675.5513">It translates HTTP primitives into</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="245.9844" x="308" y="690.6841">domain Value Objects and vice versa.</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156" x="308" y="705.8169">It has no business logic.</text><?plantuml-src bPHHRzem4CVVyobksGiW2cmIcvI7IHGwhTecMCdsn8jn3l0mjkipR57LxxvpaXRAjceJ4P3B-U__-NwN5s63EmIdXJ89RPLnmeiTB8NShhtTcs9ijVNmylrL_2I9a85lnrgX2Gdd1YML4oP0EhC-hAnMzWOfZAq9tcgDVc5Q4wyEognXL0WNqBTJ40J7ZB_8p8ELswb3BuAoXhuIZWKXoysysWbVGioijUA_VrEPepye6LL6pcabgoWqqLgikKcIkaYuU7VYDOFPT9v3NpZLTmzxKFzE5VTz4XffOUvIjh55dsRfQ3Jxb7OXlTspAHNAD1lUnnDK1n7mz0IIu__p_Qv-1izBm8cmWOFmIYmrPg2APzRCX2S4ZxTxRWKiRL5cC6TtDtLaaa-VMJps6Drz4tgFC5r-HnaeMvZ74xqkUdRLKaLxOVAgq7XRbygX-KPu_DBKstEM55UBhM7xlCQebm6XrbMBMYVwNQY5k_14hPqOoyQyMcz20YUUeK27fY3WLZBE_ApJKOP9Mmc9dKuNU5ry06hdDDDkGjNs7YVc6qN0rwHIG2DBk3O7zDGyvskaDLH3WQn8m8PO_idfy1QS5pTnZ6PLCFKWBnq2YHM6akDuu6s9quIKgeWMj2w1VWZducW8lzv7OzHBs4VKmYCe5Tv9_8u7r_3vlsVtgFR0T_CB5u_DcBCW3-zUXwJ0t_8R0sUq_7bDxVWPncmyP6wA1OQHwQhf9CSZYXpX-SIQUu9BjPwWv97NiF9s1v-jmV8CfoXVJMi67_9y1gy70vX-ZBFel9M81QNPs-6WDnZmD4fBuLAGujYRryCwncah5TBiLHMuFwtbT4mh02rRFur6YX3aqGxp99YHizTUfnE1kkQYlJ2aMPfgiqTeWAcrd5JO7R-EduuW2EQYQbZ4KpHQ6tvX6GlBFIc3HA3jMiaZGxy0?></g></svg>