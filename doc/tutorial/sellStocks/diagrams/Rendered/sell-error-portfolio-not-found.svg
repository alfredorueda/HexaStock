<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="885px" preserveAspectRatio="none" style="width:1506px;height:885px;background:#FEFEFE;" version="1.1" viewBox="0 0 1506 885" width="1506px" zoomAndPan="magnify"><defs/><g><rect fill="#FEFEFE" height="885" style="stroke:none;stroke-width:1;" width="1506" x="0" y="0"/><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="607.5859" style="stroke:#000000;stroke-width:1;" width="10" x="401.9233" y="128.5625"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="159.7969" style="stroke:#000000;stroke-width:1;" width="10" x="732.2256" y="245.2266"/></g><g><title>PortfolioPort</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="1017.377" y="274.3594"/></g><g><title>GlobalExceptionHandler</title><rect fill="#FFFFFF" height="197.1953" style="stroke:#000000;stroke-width:1;" width="10" x="1190.6343" y="434.1563"/></g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Client" id="part1-lifeline"><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="722.1172" width="8" x="66.2651" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="70" x2="70" y1="82.2969" y2="804.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="Controller" id="part2-lifeline"><g><title>PortfolioRestController</title><rect fill="#000000" fill-opacity="0.00000" height="722.1172" width="8" x="402.9233" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="406.729" x2="406.729" y1="82.2969" y2="804.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Service" id="part3-lifeline"><g><title>PortfolioStockOperationsService</title><rect fill="#000000" fill-opacity="0.00000" height="722.1172" width="8" x="733.2256" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="736.4531" x2="736.4531" y1="82.2969" y2="804.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="Port" id="part4-lifeline"><g><title>PortfolioPort</title><rect fill="#000000" fill-opacity="0.00000" height="722.1172" width="8" x="1018.377" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1022.2046" x2="1022.2046" y1="82.2969" y2="804.4141"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="Handler" id="part5-lifeline"><g><title>GlobalExceptionHandler</title><rect fill="#000000" fill-opacity="0.00000" height="722.1172" width="8" x="1191.6343" y="82.2969"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:5,5;" x1="1195.5493" x2="1195.5493" y1="82.2969" y2="804.4141"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Client" id="part1-head"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="47" y="78.9951">Client</text><ellipse cx="70.2651" cy="14" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M70.2651,22 L70.2651,49 M57.2651,30 L83.2651,30 M70.2651,49 L57.2651,64 M70.2651,49 L83.2651,64" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Client" id="part1-tail"><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="40.5303" x="47" y="816.4092">Client</text><ellipse cx="70.2651" cy="828.7109" fill="#FFFFFF" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M70.2651,836.7109 L70.2651,863.7109 M57.2651,844.7109 L83.2651,844.7109 M70.2651,863.7109 L57.2651,878.7109 M70.2651,863.7109 L83.2651,878.7109" fill="none" style="stroke:#000000;stroke-width:1;"/></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="Controller" id="part2-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="320.729" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="327.729" y="70.9951">PortfolioRestController</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="Controller" id="part2-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="172.3887" x="320.729" y="803.4141"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="158.3887" x="327.729" y="823.4092">PortfolioRestController</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Service" id="part3-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="617.4531" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="624.4531" y="70.9951">PortfolioStockOperationsService</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Service" id="part3-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="239.5449" x="617.4531" y="803.4141"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="225.5449" x="624.4531" y="823.4092">PortfolioStockOperationsService</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="Port" id="part4-head"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="100.3447" x="972.2046" y="51"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="86.3447" x="979.2046" y="70.9951">PortfolioPort</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="Port" id="part4-tail"><rect fill="#FFFFFF" height="30.2969" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="100.3447" x="972.2046" y="803.4141"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="86.3447" x="979.2046" y="823.4092">PortfolioPort</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="Handler" id="part5-head"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="186.1699" x="1102.5493" y="34.7031"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="168.9297" x="1111.1694" y="54.6982">GlobalExceptionHandler</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="172.1699" x="1109.5493" y="70.9951">(@RestControllerAdvice)</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="Handler" id="part5-tail"><rect fill="#FFFFFF" height="46.5938" rx="2.5" ry="2.5" style="stroke:#000000;stroke-width:1;" width="186.1699" x="1102.5493" y="803.4141"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="168.9297" x="1111.1694" y="823.4092">GlobalExceptionHandler</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="172.1699" x="1109.5493" y="839.7061">(@RestControllerAdvice)</text></g><g><title>PortfolioRestController</title><rect fill="#FFFFFF" height="607.5859" style="stroke:#000000;stroke-width:1;" width="10" x="401.9233" y="128.5625"/></g><g><title>PortfolioStockOperationsService</title><rect fill="#FFFFFF" height="159.7969" style="stroke:#000000;stroke-width:1;" width="10" x="732.2256" y="245.2266"/></g><g><title>PortfolioPort</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#000000;stroke-width:1;" width="10" x="1017.377" y="274.3594"/></g><g><title>GlobalExceptionHandler</title><rect fill="#FFFFFF" height="197.1953" style="stroke:#000000;stroke-width:1;" width="10" x="1190.6343" y="434.1563"/></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#000000" points="389.9233,124.5625,399.9233,128.5625,389.9233,132.5625,393.9233,128.5625" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="70.2651" x2="395.9233" y1="128.5625" y2="128.5625"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="221.7109" x="77.2651" y="108.3638">POST /api/portfolios/xyz-999/sales</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="201.5063" x="77.2651" y="123.4966">{"ticker":"AAPL", "quantity":5}</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg2"><line style="stroke:#000000;stroke-width:1;" x1="411.9233" x2="453.9233" y1="203.0938" y2="203.0938"/><line style="stroke:#000000;stroke-width:1;" x1="453.9233" x2="453.9233" y1="203.0938" y2="216.0938"/><line style="stroke:#000000;stroke-width:1;" x1="412.9233" x2="453.9233" y1="216.0938" y2="216.0938"/><polygon fill="#000000" points="422.9233,212.0938,412.9233,216.0938,422.9233,220.0938,418.9233,216.0938" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141.9463" x="418.9233" y="152.6294">Create Value Objects:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="156.5078" x="418.9233" y="167.7622">PortfolioId.of("xyz-999")</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="111.2046" x="418.9233" y="182.895">Ticker.of("AAPL")</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="167.5146" x="418.9233" y="198.0278">ShareQuantity.positive(5)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg3"><polygon fill="#000000" points="720.2256,241.2266,730.2256,245.2266,720.2256,249.2266,724.2256,245.2266" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="411.9233" x2="726.2256" y1="245.2266" y2="245.2266"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="284.2227" x="418.9233" y="240.1606">sellStock(PortfolioId, Ticker, ShareQuantity)</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg4"><polygon fill="#000000" points="1005.377,270.3594,1015.377,274.3594,1005.377,278.3594,1009.377,274.3594" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="742.2256" x2="1011.377" y1="274.3594" y2="274.3594"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="253.9761" x="749.2256" y="269.2935">getPortfolioById(PortfolioId("xyz-999"))</text></g><g class="message" data-entity-1="part4" data-entity-2="part3" id="msg5"><polygon fill="#000000" points="753.2256,299.4922,743.2256,303.4922,753.2256,307.4922,749.2256,303.4922" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="747.2256" x2="1021.377" y1="303.4922" y2="303.4922"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="110.9443" x="759.2256" y="298.4263">Optional.empty()</text></g><g class="message" data-entity-1="part3" data-entity-2="part3" id="msg6"><line style="stroke:#000000;stroke-width:1;" x1="742.2256" x2="784.2256" y1="362.8906" y2="362.8906"/><line style="stroke:#000000;stroke-width:1;" x1="784.2256" x2="784.2256" y1="362.8906" y2="375.8906"/><line style="stroke:#000000;stroke-width:1;" x1="743.2256" x2="784.2256" y1="375.8906" y2="375.8906"/><polygon fill="#000000" points="753.2256,371.8906,743.2256,375.8906,753.2256,379.8906,749.2256,375.8906" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="85.0776" x="749.2256" y="327.5591">orElseThrow(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="251.1514" x="749.2256" y="342.6919">() -&gt; new PortfolioNotFoundException(</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="126.3691" x="749.2256" y="357.8247">portfolioId.value()))</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg7"><polygon fill="#000000" points="422.9233,401.0234,412.9233,405.0234,422.9233,409.0234,418.9233,405.0234" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="416.9233" x2="736.2256" y1="405.0234" y2="405.0234"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="296.3022" x="428.9233" y="399.9575">throw PortfolioNotFoundException("xyz-999")</text></g><g class="message" data-entity-1="part2" data-entity-2="part5" id="msg8"><polygon fill="#000000" points="1178.6343,430.1563,1188.6343,434.1563,1178.6343,438.1563,1182.6343,434.1563" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;" x1="411.9233" x2="1184.6343" y1="434.1563" y2="434.1563"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="112.4297" x="418.9233" y="429.0903">handle exception</text></g><path d="M1205,447.1563 L1205,517.1563 L1351,517.1563 L1351,457.1563 L1341,447.1563 L1205,447.1563" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1341,447.1563 L1341,457.1563 L1351,457.1563 L1341,447.1563" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.9902" x="1211" y="464.2231">Exception handler</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="117.6855" x="1211" y="479.356">translates domain</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="125.5757" x="1211" y="494.4888">exceptions to HTTP</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="66.1045" x="1211" y="509.6216">responses</text><g class="message" data-entity-1="part5" data-entity-2="part5" id="msg9"><line style="stroke:#000000;stroke-width:1;" x1="1200.6343" x2="1242.6343" y1="589.2188" y2="589.2188"/><line style="stroke:#000000;stroke-width:1;" x1="1242.6343" x2="1242.6343" y1="589.2188" y2="602.2188"/><line style="stroke:#000000;stroke-width:1;" x1="1201.6343" x2="1242.6343" y1="602.2188" y2="602.2188"/><polygon fill="#000000" points="1211.6343,598.2188,1201.6343,602.2188,1211.6343,606.2188,1207.6343,602.2188" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="142.0225" x="1207.6343" y="538.7544">create ProblemDetail:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="82.0942" x="1207.6343" y="553.8872">- status: 404</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="179.8545" x="1207.6343" y="569.02">- title: "Portfolio Not Found"</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="292.1255" x="1207.6343" y="584.1528">- detail: "Portfolio with ID xyz-999 not found"</text></g><g class="message" data-entity-1="part5" data-entity-2="part2" id="msg10"><polygon fill="#000000" points="422.9233,627.3516,412.9233,631.3516,422.9233,635.3516,418.9233,631.3516" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="416.9233" x2="1194.6343" y1="631.3516" y2="631.3516"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="214.7158" x="428.9233" y="626.2856">ResponseEntity&lt;ProblemDetail&gt;</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg11"><polygon fill="#000000" points="81.2651,732.1484,71.2651,736.1484,81.2651,740.1484,77.2651,736.1484" style="stroke:#000000;stroke-width:1;"/><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="75.2651" x2="405.9233" y1="736.1484" y2="736.1484"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="145.5645" x="87.2651" y="655.4185">HTTP 404 NOT FOUND</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="87.2651" y="670.5513">{</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="187.1226" x="95.5298" y="685.6841">"title": "Portfolio Not Found",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="299.3936" x="95.5298" y="700.8169">"detail": "Portfolio with ID xyz-999 not found",</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="85.23" x="95.5298" y="715.9497">"status": 404</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8.271" x="87.2651" y="731.0825">}</text></g><path d="M10,749.1484 L10,789.1484 L1256,789.1484 L1256,759.1484 L1246,749.1484 L10,749.1484" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><path d="M1246,749.1484 L1246,759.1484 L1256,759.1484 L1246,749.1484" fill="#FFFFFF" style="stroke:#000000;stroke-width:1;"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="242.3979" x="480.7307" y="766.2153">Domain Exception &#8594; HTTP Status</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="296.2578" x="480.7307" y="781.3481">PortfolioNotFoundException &#8594; 404 Not Found</text><?plantuml-src ZLJHRjem57tFLznvBmc2ieVseT5KhGEwLfeAAsnFl9ZaKZoCdTc6bavztGVi4_SbivsGE4XCKwJ8TkuzzznphlF6h723K73AHAJNJ1HKqGqiQBP-L78hye7aKi7Rcv5xeeXcncu7dA4maOqrB6C55GR8H2gpb9p91zHc88LHadDK1AY6PdiYPsfajXuNgAXXKkWfgXtBqETMwnE9Rk73tA8TyudB1UMZvmmB1tfBHMu9p4NyeStmEdVuYKUfWgAex11wLm7t52RZwGpwj63zua10zv_tBxtBoyk-fXprNFmabiBQDfwIw-l9Pz85ycDh2J6p9-d5grEGxQZ1K9IeMH-N72XqmTyetoAC5zynCpgTYrg0k_nCBcDIaI39NCnyUN_g2TYZwOeg_5AnE2kaPfO3nXV9SULAx1GqSkvDYODANIYnkz02J9gU3cP5rS9XEe0K7j7KI1_tTtc86z0FiBoZxWMzaDdOkqdv6MuAiu-JACTsIbYxpf9gn3NELae-nNO44lTHu1FKBEwbkN7pNi-B3Ii2aNVEW3Yn11ly8wkCG_yNOjDcIBhMh6r5DOefhFm2y03JA7IOLY7jHh77bG6vh4y1wieLXZipYWhDRRQ6N6xShOS6MeEHS3kRJUoXGbtO4zGHYXnSYIYge5lqid909qekE6w6Q2ZZTa1xe0qrMvt2-RjpjxMJmgqHpTK5An1uXOZxdfUPOS0JCoku6q8bcoC1IvyGK3aouQ6YFVAZ-Rv5wogKlRdgWUmEpD_yrClWkCFzU0Otuw_tGtktvmA0-4x8YLQwFgHiXlndDsLEgHUf17iDkOQ_2c-stE7XBzmD3EzqXjxJmFa_ltwNhKmzVATZmqwFg0_tJHyQQjp_2m00?></g></svg>